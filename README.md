# @clawdbot/supermemory

Long-term memory integration for Clawdbot using [Supermemory](https://supermemory.ai).

## Features

- **Automatic memory storage**: Compacted conversation summaries are automatically stored as long-term memories
- **Auto-recall**: Relevant memories are automatically injected into agent context at conversation start
- **Dual-mode operation**: Run alongside built-in memory (tandem) or replace it entirely (primary)
- **Flexible namespacing**: Organize memories with container tags

## Installation

### Method 1: CLI Installation (Recommended)

```bash
# 1. Download and install the plugin
cd /tmp
curl -L https://github.com/hoverlover/clawdbot-supermemory/archive/refs/heads/main.tar.gz -o supermemory.tar.gz
clawdbot plugins install /tmp/supermemory.tar.gz

# 2. Add to allowlist
clawdbot config set plugins.allow '["supermemory"]'

# 3. Enable the plugin
clawdbot plugins enable supermemory

# 4. Set your Supermemory API key
clawdbot config set plugins.entries.supermemory.config.apiKey "YOUR_SUPERMEMORY_API_KEY"

# 5. Optionally set mode (tandem is default)
clawdbot config set plugins.entries.supermemory.config.mode "tandem"

# 6. Restart the gateway
clawdbot gateway restart

# 7. Verify
clawdbot plugins list
```

### Method 2: Manual Config Editing

Edit `~/.clawdbot/clawdbot.json` and add/merge:

```json
{
  "plugins": {
    "allow": ["supermemory"],
    "entries": {
      "supermemory": {
        "enabled": true,
        "config": {
          "apiKey": "YOUR_SUPERMEMORY_API_KEY",
          "mode": "tandem"
        }
      }
    }
  }
}
```

Then restart:

```bash
clawdbot gateway restart
```

## Configuration Options

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| apiKey | string | (required) | Your Supermemory API key |
| mode | string | tandem | Memory mode: tandem, primary, or off |
| autoRecall | boolean | true | Auto-inject memories on agent start |
| threshold | number | 0.5 | Chunk relevance threshold (0.0-1.0) |
| containerTag | string | (optional) | Custom namespace for memories |
| baseUrl | string | (optional) | Custom Supermemory API endpoint |

## Getting a Supermemory API Key

1. Sign up at https://console.supermemory.ai
2. Navigate to API Keys
3. Create a new API key

## Modes

### Tandem Mode (default)

Both Clawdbot's built-in memory and Supermemory are active:

- Built-in `memory_search` remains available
- Additional `supermemory_search` tool is registered
- Memories are stored in Supermemory on compaction
- Agent can query either memory source

### Primary Mode

Supermemory completely replaces built-in memory:

- `memory_search` tool queries Supermemory instead
- Built-in memory system is disabled via slot
- Requires slot configuration

### Off Mode

Plugin is disabled entirely.

## How It Works

### Memory Storage (after_compaction hook)

When a conversation session is compacted, the compacted summary is automatically stored in Supermemory:

1. Agent session accumulates messages
2. Compaction is triggered (auto or manual)
3. Summary is generated by the LLM
4. `after_compaction` hook fires with the summary
5. Summary is stored in Supermemory via `POST /v3/documents`

### Memory Retrieval (before_agent_start hook)

When a new agent conversation starts, relevant memories are automatically retrieved:

1. User sends a message
2. `before_agent_start` hook fires with the prompt
3. Plugin queries Supermemory `POST /v3/search`
4. Relevant memories are injected into agent context
5. Agent has historical context for the conversation

## Tools

### supermemory_search (tandem mode)

Search Supermemory for long-term memories:

```
User: Search my supermemory for user preferences
```

### memory_search (primary mode)

When in primary mode, this tool queries Supermemory instead of built-in memory.

## API Reference

This plugin uses the Supermemory v3 REST API:

- `POST /v3/documents` - Store new memory content
- `POST /v3/search` - Search memories

See [Supermemory docs](https://supermemory.ai/docs/api-reference) for details.

## License

MIT
